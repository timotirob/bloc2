= R√©vision : D√©pendances Fonctionnelles et Formes Normales (FN)
:doctype: article
:encoding: utf-8
:lang: fr
:toc: left
:toc-title: Sommaire
:allow-uri-read:
:imagesdir: ./images

== üéØ Objectifs de la r√©vision
* Mieux appr√©hender le niveau de la mod√©lisation relationnelle
* Comprendre la notion de **D√©pendance Fonctionnelle** (DF).
* Ma√Ætriser les d√©finitions et les crit√®res de la **1√®re, 2√®me, 3√®me Forme Normale** (1NF, 2NF, 3NF).
* Ma√Ætriser la d√©finition et le crit√®re de la **Forme Normale de Boyce-Codd** (BCNF).
* Savoir appliquer la normalisation pour obtenir un Mod√®le Relationnel propre (jusqu'√† 3NF/BCNF).

== üí° Fondements et Terminologie
Un mod√®le de donn√©es relationnel doit √™tre normalis√© pour √©liminer la redondance et les anomalies de mise √† jour (insertion, modification, suppression).

.Niveaux de mod√©lisation (Conceptuel / Logique / Physique)
image::NiveauxMod√©lisations.png[Niveaux de mod√©lisation, width=600, align="center"]

=== D√©finition du mod√®le relationnel

Un mod√®le logique de donn√©es sp√©cifiant un sch√©ma pour une base de donn√©es relationnelle soit : les tables, les champs de chaque table et leurs propri√©t√©s, la cl√© primaire des tables, les cl√©s √©trang√®res assurant les liaisons entre les tables et les contraintes d‚Äôint√©grit√© portant sur ces liaisons

Pertinence du mod√®le relationnel:

* Ind√©pendant du SGBD, tout en √©tant plus proche des tables
* Etape de v√©rification / validation mod√®le
* Typage et estimation volum√©trie de la base
* Pr√©cisions sur les contraintes, notamment UNIQUE et CHECK

=== Vocabulaire

Le sch√©ma suivant illustre les diff√©rents termes utilis√©s pour des m√™mes notions selon le contexte:

.Des termes diff√©rents pour la m√™me notion selon le contexte
image::Vocabulaire.png[Contextes, width=600, align="center"]

=== D√©pendance Fonctionnelle (DF)
Une d√©pendance fonctionnelle, not√©e DETERMINANT -> DEPENDANT, signifie que pour toute valeur de l'attribut ou du groupe d'attributs DETERMINANT (le *d√©terminant*), il existe une seule valeur correspondante pour l'attribut ou le groupe d'attributs DEPENDANT (le *d√©termin√©*).

* *Exemple :* `Num√©ro Employ√©` -> `Nom Employ√©`

==== Dep√©ndance fonctionnelle √©l√©mentaire

Une DF (Attribut1, Attribut2) -> DEPENDANT est √©l√©mentaire si
Attribut1 -> DEPENDANT n‚Äôest pas DF ET
Attribut2 -> DEPENDANT n‚Äôest pas DF

Permet de d√©tecter les probl√®mes de 2√®me Forme Normale

Exemple (C. SOUTOU: demandez moi les scripts si vous ne les retrouvez pas): `( num_pilote,jour ) -> nb_heures_vol est √©l√©mentaire`

==== Dep√©ndance fonctionnelle directe

Une DF DETERMINANT -> DEPENDANT est directe si elle ne peut pas √™tre d√©duite par transitivit√© c‚Äôest √† dire:

- DETERMINANT -> attributX n‚Äôest pas DF OU BIEN
- AttributX -> DEPENDANT n‚Äôest pas DF

Permet de d√©tecter les probl√®mes de 3√®me Forme Normale

Exemple (C. SOUTOU): immatriculation a√©ronef -> nom du constructeur n‚Äôest PAS directe car
immatriculation a√©ronef -> type avion est DIRECTE ET
Type avion -> nom constructeur est aussi DIRECTE


=== Niveau Logique
Le niveau logique se rapproche des tables tout en restant ind√©pendant du Syst√®me de Gestion de Base de Donn√©es (SGBD). C'est √† ce niveau que les Formes Normales sont appliqu√©es.

=== Principes de mod√©lisation
Un mod√®le de donn√©es relationnel doit √™tre normalis√©
La notion de normalisation comporte plusieurs niveaux, appel√©s formes, que nous allons pr√©senter successivement

Chaque forme normale permet de r√©soudre des probl√®mes de mod√©lisation que posent un non respect de ces principes

== ü•á 1√®re Forme Normale (1NF)


Une relation est en **1NF** si et seulement si:

1. Elle poss√®de au moins une clef
2. Tous ses attributs sont *atomiques* (indivisibles)
3. Aucun attribut n'est r√©p√©t√©


=== Probl√®me typique

La relation ci-dessous est-elle en 1√®re forme normale ? Si non, que faut-il faire ?

.Probl√®me de 1√®re Forme Normale
image::PB1NF.png[Contextes, width=600, align="center"]

=== Solution au probl√®me de multivaluation

La solution consiste √† ajouter des relations, c'est √† dire des tables.
Nous obtenons:

* une table Produit
* une table Couleurs
* une table d'association Coloris qui permet les combinaisons de produit et de couleur

.Solution au probl√®me de multivaluation
image::SOL1NF.png[Contextes, width=600, align="center"]


== ü•à 2√®me Forme Normale (2NF)


Une relation en **1NF** est en **2NF** si et seulement si:

*tout attribut non-cl√© est en d√©pendance fonctionnelle compl√®te vis-√†-vis de la cl√© primaire*.


* *R√®gle :* Il ne doit y avoir aucune **d√©pendance fonctionnelle partielle** de la cl√© primaire vers un attribut non-cl√©. (Concerne uniquement les relations avec une cl√© primaire compos√©e).

* Autre r√©daction: tout attribut non clef ne d√©pend pas d‚Äôune partie de la clef

=== Sch√©ma contre exemple

Le sch√©ma ci dessous montre une relation (table) qui est en 1NF mais N'est PAS en 2NF:

.Relation pas en 2NF
image::SchemaNon2NF.png[Contextes, width=600, align="center"]

=== Probl√®me typique (D√©pendance partielle)

Le sch√©ma ci dessous n'est PAS en 2√®me forme normale.

* Pourquoi ?
* Quel probl√®me cela pose t'il ?

.Probl√®me de 2√®me Forme Normale
image::PB2NF.png[Contextes, width=600, align="center"]


=== Solution au probl√®me de 2√®me forme normale

==== Astuce et √† se rappeler
Les probl√®mes de forme normale concernent TOUJOURS une clef primaire compos√©e (identifiant compos√© de plusieurs colonnes)

==== Solution

On d√©place l'attribut Poids de la table d'association vers le Produit: le poids √©tant ind√©pendant du Coloris on respecte ainsi la 2NF

.Solution au probl√®me de d√©pendance partielle
image::SOL2NF.png[Contextes, width=600, align="center"]

== ü•â 3√®me Forme Normale (3NF)


Une relation en **2NF** est en **3NF** si et seulement si *aucun attribut non-cl√© n'est en d√©pendance fonctionnelle transitive vis-√†-vis de la cl√© primaire*.

* *R√®gle :* Il ne doit y avoir aucune d√©pendance d'un attribut non-cl√© vers un autre attribut non-cl√©.

* 2√®me r√©daction possible: tout attribut non clef ne d√©pend pas d‚Äôun autre attribut non clef

* 3√®me r√©daction possible: tout attribut n'appartenant pas √† la cl√© ne d√©pend pas transitivement de la cl√©



Si A -> B et B -> C et que A est la cl√©, alors il y a une **d√©pendance transitive** A -> C via B.

=== Sch√©ma contre exemple

Le sch√©ma ci dessous montre une relation (table) qui est en 2NF mais N'est PAS en 3NF:

.Relation pas en 3NF
image::SchemaNon3NF.png[Contextes, width=600, align="center"]

=== Illustration

√Ä titre d'illustration, la relation:

`VOITURE (NV, MARQUE, TYPE, PUISSANCE, COULEUR)`

n'est pas en troisi√®me forme normale.

En effet, l'attribut non-cl√© TYPE d√©termine MARQUE et aussi PUISSANCE.

Cette relation peut √™tre d√©compos√©e en deux relations:

`VOITURE (NV, TYPE, COULEUR)`

`MODELE (TYPE, MARQUE, PUISSANCE)`.

=== Probl√®me typique

Le sch√©ma ci dessous n'est PAS en 3√®me forme normale.

* Pourquoi ?
* Quel probl√®me cela pose t'il ?

.Probl√®me de 3√®me Forme Normale
image::PB3NF.png[Contextes, width=600, align="center"]


=== Solution au probl√®me de 3√®me forme normale

==== Astuce et √† se rappeler
Les probl√®mes de forme normale concernent g√©n√©ralement un attribut qui doit √™tre plac√© dans une autre relation (table) qui est √† un niveau plus "agr√©g√©"

==== Solution

On d√©place la Marque dans une autre relation (table)

.Solution au probl√®me de d√©pendance transitive
image::SOL3NF.png[Contextes, width=600, align="center"]


== üëë Forme Normale de Boyce-Codd (BCNF)


Une relation est en **BCNF** si et seulement si elle est en **3NF** *ET* si toute d√©pendance fonctionnelle non triviale A -> B v√©rifie que A est une **cl√© candidate** pour la relation.

* *R√®gle simplifi√©e :* Le seul d√©terminant (partie gauche de la DF) est une cl√© candidate (aucune d√©pendance vers une partie de la clef ne doit exister)

=== Sch√©ma contre exemple

Le sch√©ma ci dessous montre une relation (table) qui est en 3NF mais N'est PAS en BCNF:

.Relation pas en BCNF
image::SchemaNonBCNF.png[Contextes, width=600, align="center"]


== üìù Exercices de Mod√©lisation (Solutions)

=== Exercice 1 : Professions

La relation ci dessous est elle en 1√®re forme Normale. Si non, que changer ?

.Profession
image::Exo1.png[Contextes, width=600, align="center"]

=== Exercice 2 : Fournisseurs

Soit la table suivante:

`Fournisseur( nom, article, adresse, prix)` .

La clef primaire est compos√©e, de  nom et article

1. Quelles sont les d√©pendances fonctionnelles ?

2. La table Fournisseur est elle en 2√®me forme normale ?

3. Si non, quelles corrections effectuer pour √™tre en 2 FN ?

=== Exercice 3 : Vin (Gardarin)

Soit la table, concernant le domaine du vin, suivante:

`Localisation( cru, pays, r√©gion, qualit√©)` .

La clef primaire est compos√©e, de  `cru et pays`

Les DF sont les suivantes:

* `(Cru, pays) -> R√©gion`
* `(Cru, pays) -> Qualit√©`   (tr√®s franchouillard)
* `R√©gion -> Pays`

Exemple de cru: Chablis (on en trouve en France dans r√©gion Beaujolais et aux USA r√©gion Californie)

1. Est elle en BCNF ?

2. Si non, comment faire pour respecter la BCNF ?

=== Exercice 4 :  Recette de cuisine (R. Grin)

On souhaite cr√©er une BDD de recette de cuisine:

* Une recette est identifi√©e par son num√©ro.
* Elle a un nom et un type particulier (soupe, entr√©e, dessert, ...).
* Elle utilise un ou plusieurs ingr√©dients (carottes, viande de boeuf, poivre, ...).
* Un ingr√©dient est identifi√© par son num√©ro et a un nom.
* Pour chaque ingr√©dient dans une recette, on pr√©cisera sa quantit√©.

1. Donner la liste des DF (d√©pendances fonctionnelles) pour la relation `R = {NumR, NomR,TypeR, NumI, NomI, Qte}`
2. Proposer une d√©composition de R qui respecte les FN
3. Critiquer la d√©composition d√©composition suivante:

`R1 = (NumR, NomR,TypeR)`

`R2 = (NumR, NumI, Qte)`

`R3 = (NumI, NomI)`

`R4 = (NumR, Ustensile)`


=== Exercice 5 : Ligne de Commande

Une commande est compos√©e de plusieurs lignes de commande avec un produit associ√©.
Soit la relation suivante :

*Relation :* `LigneCommande (Num√©ro de commande, Num√©ro de produit, Description, Prix, Quantit√©)`

a.	Donnez les d√©pendances fonctionnelles (DF) de la relation
b.	Proposez une clef pour cette relation
c.	A quelle forme normale se conforme la relation ?
d.	Critiquez


=== Exercice 6 : Employ√©



=== Exercice 3 : Bon de Commande


*Objectif :* Mod√®le relationnel en **3√®me forme normale**.

| Relation | Cl√© Primaire (PK) | Attributs |
| :--- | :--- | :--- |
| **CLIENT** | **`Num√©ro Client`** | `Num√©ro Client`, `Nom Client`, `Adresse Client` |
| **COMMANDE** | **`Num√©ro Commande`** | `Num√©ro Commande`, `Date Commande`, `Num√©ro Client` (FK) |
| **PRODUIT** | **`Num√©ro Produit`** | `Num√©ro Produit`, `Description Produit`, `Prix Unitaire` |
| **LIGNE_COMMANDE** | **`Num√©ro Commande`, `Num√©ro Produit`** | `Num√©ro Commande` (FK), `Num√©ro Produit` (FK), `Quantit√©` |

=== Exercice 4 : Groupe Musical

*Hypoth√®ses :* Cl√© : `(Salle, Ann√©e, Groupe)`.

1.  **Extrait 1 :** `(Salle, Ann√©e, Groupe, Genre)`

* **DF :** `Groupe` $\to$ `Genre`.
* **Forme Normale :** **1NF**. **N'est pas en 2NF** (d√©pendance partielle).

2.  **Extrait 2 :** `(Salle, Ann√©e, Groupe, Spectateurs)`

* **DF :** `(Salle, Ann√©e, Groupe)` $\to$ `Spectateurs`.
* **Forme Normale :** **3NF**. (Satisfait 2NF et 3NF).

=== Exercice 5 : Transport Maritime
*Cl√©(s) :* $K = \{\text{Bateau, Date arriv√©e}\}$

* **Mod√©lisation BCNF propos√©e :**
* **BATEAU** (`Bateau`, `Type bateau`)
* **VOYAGE** (`Identifiant voyage`, `Cargaison`)
* **TRANSPORT** (`Bateau*`, `Date arriv√©e`, `Identifiant voyage*`, `Port de destination`)